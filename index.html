<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>World Diabetes Day 2025 Doorprize</title>
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* 3. Set custom font and smooth scrolling */
      body {
        font-family: "Inter", sans-serif;
        scroll-behavior: smooth;
      }
      /* 4. Style the canvas for crisp rendering on high-DPI screens */
      #wheelCanvas {
        width: 100%;
        max-width: 500px;
        height: auto;
        aspect-ratio: 1 / 1;
      }
      /* Custom colors for Tropicana Slim theme */
      .bg-tropicana-light {
        background-color: #fff3e0; /* Lightest cream/yellow */
      }
      .bg-tropicana-medium {
        background-color: #ffc107; /* Bright yellow */
      }
      .bg-tropicana-dark {
        background-color: #ffa000; /* Orange-yellow */
      }
      .text-tropicana-darkest {
        color: #8d4700; /* Dark brown/orange */
      }
      .border-tropicana-medium {
        border-color: #ffc107;
      }
      .ring-tropicana-medium {
        --tw-ring-color: #ffc107;
      }
    </style>
  </head>
  <body
    class="bg-tropicana-light text-gray-900 flex flex-col items-center min-h-screen p-4 md:p-8"
  >
    <div class="w-full max-w-6xl">
      <h1
        class="text-3xl md:text-4xl font-bold text-center text-tropicana-darkest mb-6"
      >
        World Diabetes Day 2025 Doorprize
      </h1>

      <p class="text-center text-gray-700 mb-8 max-w-2xl mx-auto">
        by Tropicana Slim
      </p>

      <div class="flex flex-col md:flex-row gap-8">
        <!-- Left Column: Controls -->
        <div class="w-full md:w-1/3 bg-white p-6 rounded-lg shadow-md">
          <label for="names" class="block text-lg font-semibold mb-2"
            >Input Here</label
          >
          <textarea
            id="names"
            class="w-full h-64 p-3 border border-gray-300 rounded-lg focus:ring-2 ring-tropicana-medium focus:outline-none"
            placeholder="Angela
Deri
Rifat
Yasyfa
..."
          ></textarea>
          <p class="text-xs text-gray-500 mt-2">
            Tip: For lists over 100, text won't be drawn on the wheel (for
            performance), but a winner will still be chosen.
          </p>
          <button
            id="updateButton"
            class="w-full bg-tropicana-dark text-white font-semibold py-3 px-4 rounded-lg mt-4 hover:bg-tropicana-medium focus:outline-none focus:ring-2 ring-tropicana-medium focus:ring-offset-2 transition-colors"
          >
            Update Wheel
          </button>
        </div>

        <!-- Right Column: Wheel -->
        <div class="w-full md:w-2/3 flex flex-col items-center">
          <div class="relative w-full max-w-[500px] flex justify-center">
            <!-- The pointer -->
            <div
              class="absolute -top-1 z-10 w-0 h-0"
              style="
                border-left: 20px solid transparent;
                border-right: 20px solid transparent;
                border-top: 30px solid #8d4700; /* Dark brown for pointer */
              "
            ></div>
            <!-- The canvas where the wheel is drawn --><canvas
              id="wheelCanvas"
              width="500"
              height="500"
            ></canvas>
          </div>
          <button
            id="spinButton"
            class="w-full max-w-[500px] bg-tropicana-medium text-tropicana-darkest font-bold text-2xl py-4 px-6 rounded-lg mt-6 hover:bg-tropicana-dark focus:outline-none focus:ring-2 ring-tropicana-medium focus:ring-offset-2 transition-all shadow-lg transform active:scale-95"
          >
            SPIN!
          </button>
        </div>
      </div>
    </div>

    <!-- Winner Modal -->
    <div
      id="winnerModal"
      class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 hidden"
    >
      <div
        class="bg-white rounded-lg shadow-2xl p-8 md:p-12 text-center max-w-md w-full"
      >
        <h2 class="text-2xl font-semibold text-gray-700 mb-4">
          We have a winner!
        </h2>
        <div
          class="bg-tropicana-light border-2 border-tropicana-medium border-dashed rounded-lg p-6 my-6"
        >
          <span
            id="winnerName"
            class="text-4xl font-bold text-tropicana-darkest break-all"
          ></span>
        </div>
        <div class="flex flex-col sm:flex-row gap-4 mt-8">
          <button
            id="closeModalButton"
            class="w-full bg-gray-400 text-white font-semibold py-3 px-4 rounded-lg hover:bg-gray-500 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition-colors"
          >
            Just Close
          </button>
          <button
            id="removeWinnerButton"
            class="w-full bg-red-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors"
          >
            Remove Winner & Close
          </button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const canvas = document.getElementById("wheelCanvas");
        const ctx = canvas.getContext("2d");
        const namesTextarea = document.getElementById("names");
        const updateButton = document.getElementById("updateButton");
        const spinButton = document.getElementById("spinButton");
        const winnerModal = document.getElementById("winnerModal");
        const winnerName = document.getElementById("winnerName");
        const closeModalButton = document.getElementById("closeModalButton");
        const removeWinnerButton =
          document.getElementById("removeWinnerButton");

        // --- State Variables ---
        let names = [];
        let currentWinnerIndex = -1;
        // Updated colors to match Tropicana Slim theme (yellows, oranges, light greens)
        const colors = [
          "#FFD54F", // Light Yellow
          "#FFB300", // Medium Yellow
          "#FF8F00", // Orange
          "#FFEE58", // Brighter Yellow
          "#FFF176", // Muted Yellow
          "#FFCC80", // Light Orange
          "#FFAB40", // Medium Orange
          "#C5E1A5", // Light Green (for a fresh feel, like some Tropicana products)
          "#AED581", // Medium Green
          "#FFD700", // Gold-ish yellow
        ];

        // --- Optimization: Pre-rendered Canvas ---
        // This is the secret to high performance. We draw the complex wheel
        // (with all 500 slices) *once* to this hidden canvas.
        // Then, the animation just rotates this single image.
        const preRenderedCanvas = document.createElement("canvas");
        preRenderedCanvas.width = canvas.width;
        preRenderedCanvas.height = canvas.height;
        const pCtx = preRenderedCanvas.getContext("2d");

        // --- Wheel Physics ---
        let currentRotation = 0;
        let spinVelocity = 0;
        let isSpinning = false;
        const friction = 0.94; // 0.995 = lambat, 0.96 = ~3 detik, 0.94 = ~2 detik
        const radius = canvas.width / 2;

        // --- Core Functions ---

        /**
         * Draws the wheel (slices and names) to the hidden pre-rendered canvas.
         * This is the most performance-intensive part, so we only do it once.
         */
        function drawWheel() {
          const numSlices = names.length;
          if (numSlices === 0) {
            // Draw a placeholder if no names
            pCtx.clearRect(0, 0, canvas.width, canvas.height);
            pCtx.fillStyle = "#f0f0f0"; // Changed to a neutral color
            pCtx.beginPath();
            pCtx.arc(radius, radius, radius - 5, 0, 2 * Math.PI);
            pCtx.fill();
            pCtx.fillStyle = "#666";
            pCtx.font = "20px Inter";
            pCtx.textAlign = "center";
            pCtx.textBaseline = "middle";
            pCtx.fillText("Add names to update wheel", radius, radius);

            // Also draw to the main canvas
            ctx.drawImage(preRenderedCanvas, 0, 0);
            return;
          }

          const arc = (2 * Math.PI) / numSlices;
          const showText = numSlices <= 100; // Only show text if 100 or fewer

          pCtx.clearRect(0, 0, canvas.width, canvas.height);
          pCtx.save();
          pCtx.translate(radius, radius); // Move origin to center

          for (let i = 0; i < numSlices; i++) {
            // 1. Draw the slice
            pCtx.beginPath();
            pCtx.fillStyle = colors[i % colors.length];
            pCtx.moveTo(0, 0);
            pCtx.arc(0, 0, radius, 0, arc);
            pCtx.lineTo(0, 0);
            pCtx.fill();

            // 2. Draw text (if enabled)
            if (showText) {
              pCtx.save();
              pCtx.rotate(arc / 2); // Rotate to center of slice
              pCtx.textAlign = "right";
              pCtx.textBaseline = "middle";
              pCtx.fillStyle = "#8D4700"; // Dark brown text for contrast

              // Adjust font size based on number of names
              let fontSize = 16;
              if (numSlices > 20) fontSize = 12;
              if (numSlices > 50) fontSize = 10;

              pCtx.font = `bold ${fontSize}px Inter`;
              pCtx.fillText(names[i].substring(0, 20), radius - 10, 0); // Limit text length
              pCtx.restore();
            }

            pCtx.rotate(arc); // Rotate context for next slice
          }

          pCtx.restore(); // Restore context to default

          // Draw the pre-rendered wheel to the visible canvas
          ctx.drawImage(preRenderedCanvas, 0, 0);
        }

        /**
         * The main animation loop. Runs 60 times/sec while spinning.
         * This function is highly optimized.
         */
        function animateLoop() {
          if (!isSpinning) return;

          // 1. Apply spin and friction
          currentRotation += spinVelocity;
          spinVelocity *= friction;

          // 2. Draw the *entire* pre-rendered canvas, but rotated
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.save();
          ctx.translate(radius, radius); // Go to center
          ctx.rotate(currentRotation); // Rotate
          ctx.drawImage(preRenderedCanvas, -radius, -radius); // Draw pre-rendered image
          ctx.restore(); // Back to normal

          // 3. Stop condition
          if (spinVelocity < 0.001) {
            isSpinning = false;
            spinButton.disabled = false;
            spinButton.textContent = "SPIN!";
            calculateWinner();
          } else {
            requestAnimationFrame(animateLoop);
          }
        }

        /**
         * Calculates the winner based on the final rotation angle
         */
        function calculateWinner() {
          const numSlices = names.length;
          if (numSlices === 0) return;

          const arc = (2 * Math.PI) / numSlices;

          // The pointer is at the top (3*PI/2 or -PI/2).
          // We need to find which slice landed there.
          const pointerAngle = (3 * Math.PI) / 2;
          const normalizedRotation = currentRotation % (2 * Math.PI);

          // Calculate the angle on the *original* wheel that is now at the top
          const winningAngle =
            (pointerAngle - normalizedRotation + 2 * Math.PI) % (2 * Math.PI);

          // Find the index of the slice that contains that angle
          const winnerIndex = Math.floor(winningAngle / arc);

          showWinnerModal(names[winnerIndex], winnerIndex);
        }

        /**
         * Displays the winner modal
         */
        function showWinnerModal(winner, index) {
          winnerName.textContent = winner;
          currentWinnerIndex = index;
          winnerModal.classList.remove("hidden");
        }

        // --- Event Listeners ---

        /**
         * Handles "Update Wheel" click
         * Parses text, updates state, and calls drawWheel()
         */
        updateButton.addEventListener("click", () => {
          const text = namesTextarea.value;
          names = text.split("\n").filter((name) => name.trim() !== "");

          // Reset rotation
          currentRotation = 0;
          spinVelocity = 0;
          isSpinning = false;

          drawWheel(); // This re-draws the pre-rendered canvas
        });

        /**
         * Handles "Spin" click
         */
        spinButton.addEventListener("click", () => {
          if (isSpinning || names.length === 0) return;

          isSpinning = true;
          spinButton.disabled = true;
          spinButton.textContent = "Spinning...";

          // Give it a strong, random initial spin
          spinVelocity = Math.random() * 0.4 + 0.3; // Random force between 0.3 and 0.7

          animateLoop();
        });

        /**
         * Handles "Close Modal" click
         */
        closeModalButton.addEventListener("click", () => {
          winnerModal.classList.add("hidden");
          currentWinnerIndex = -1;
        });

        /**
         * Handles "Remove Winner & Close" click
         */
        removeWinnerButton.addEventListener("click", () => {
          if (currentWinnerIndex > -1 && currentWinnerIndex < names.length) {
            // Remove the winner from the array
            names.splice(currentWinnerIndex, 1);

            // Update the textarea to reflect the change
            namesTextarea.value = names.join("\n");

            // Redraw the wheel with the updated names list
            drawWheel();
          }

          // Hide the modal and reset the index
          winnerModal.classList.add("hidden");
          currentWinnerIndex = -1;
        });

        // --- Initial Setup ---
        drawWheel(); // Draw the initial placeholder
      });
    </script>
  </body>
</html>
